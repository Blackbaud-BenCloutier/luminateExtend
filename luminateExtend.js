/*
 * luminateExtend.js
 * Version: 1.0 (21-SEP-2012)
 * Requires: jQuery v1.7+
 * Includes: SimpleDateFormatJS v1.0 (https://github.com/noahcooper/SimpleDateFormatJS)
 */
(function(a){var b=function(a,b){b=b||window;var c=b;if(a){var d=a.split(".");for(i=0;i<d.length;i++){if(i<d.length-1&&!c[d[i]]){c[d[i]]={}}c=c[d[i]]}}return c},c=function(a,b){var c=(a?luminateExtend.global.path.secure+"S":luminateExtend.global.path.nonsecure)+"PageServer?pagename=luminateExtend_server&pgwrap=n"+(luminateExtend.global.sessionCookie?"&"+luminateExtend.global.sessionCookie:"")+(b?"&"+b:"");return c};window.luminateExtend=function(a){if(a){luminateExtend.init(a)}};luminateExtend.library={version:"1.0"};luminateExtend.global={update:function(b,c){if(b){if(b.length){luminateExtend.global[b]=c}else{luminateExtend.global=a.extend(luminateExtend.global,b)}}}};luminateExtend.init=function(b){var c=a.extend({apiCommon:{categoryId:null,centerId:null,source:null,subSource:null},apiKey:null,auth:{token:null,type:"auth"},locale:null,path:{nonsecure:null,secure:null}},b||{});if(c.locale!=null&&c.locale!="es_US"&&c.locale!="en_CA"&&c.locale!="fr_CA"&&c.locale!="en_GB"){c.locale="en_US"}if(c.locale!=null){luminateExtend.sessionVars.set("locale",c.locale)}luminateExtend.global=a.extend(luminateExtend.global,c);return luminateExtend};luminateExtend.api={bind:function(c){c=c||"form.luminateApi";if(a(c).length>0){a(c).each(function(){if(this.nodeName.toLowerCase()=="form"){a(this).on("submit",function(c){c.cancelBubble=true;c.returnValue=false;if(c.stopPropagation){c.stopPropagation();c.preventDefault()}var d=(new Date).getTime();if(!a(this).attr("id")){a(this).attr("id","luminateApi-"+d)}var e=a(this).attr("action"),f=e.split("?"),g=a(this).data("luminateapi"),h=f[0].indexOf("/site/")!=-1?f[0].split("/site/")[1]:f[0],i=null,j=a(this).attr("enctype"),k=f.length>1?f[1]:"",l="#"+a(this).attr("id"),m=false,n=a(this).attr("method"),o=false;if(g){if(g.callback){i=b(g.callback)}if(g.requiresAuth&&g.requiresAuth=="true"){m=true}if(e.indexOf("https:")==0||window.location.protocol=="https:"&&e.indexOf("http")==-1){o=true}}luminateExtend.api.request({api:h,callback:i,contentType:j,data:k,form:l,requestType:n,requiresAuth:m,useHTTPS:o})})}})}return luminateExtend},getAuth:function(b){if(luminateExtend.api.getAuthLoad){luminateExtend.api.getAuthLoad=false;var d=a.extend({callback:null,returnLib:true,useHTTPS:false},b||{});a.ajax({dataType:"jsonp",success:function(a){luminateExtend.global.update(a);luminateExtend.api.getAuthLoad=true;if(d.callback!=null){d.callback()}if(d.returnLib){return luminateExtend}},url:c(d.useHTTPS,"action=getAuth&callback=?")})}else{var e=function(){luminateExtend.api.getAuth(b)},f=setTimeout(e,1e3)}},getAuthLoad:true,request:function(b){var d=a.extend({api:null,callback:null,contentType:"application/x-www-form-urlencoded",data:"",form:null,requestType:"GET",requiresAuth:false,useHashTransport:false,useHTTPS:null},b||{});switch(d.api.toLowerCase()){case"addressbook":d.api="CRAddressBookAPI";break;case"advocacy":d.api="CRAdvocacyAPI";break;case"connect":d.api="CRConnectAPI";break;case"cons":d.api="CRConsAPI";break;case"content":d.api="CRContentAPI";break;case"datasync":d.api="CRDataSyncAPI";break;case"donation":d.api="CRDonationAPI";break;case"event":d.api="CROrgEventAPI";break;case"group":d.api="CRGroupAPI";break;case"orgevent":d.api="CROrgEventAPI";break;case"recurring":d.api="CRRecurringAPI";break;case"survey":d.api="CRSurveyAPI";break;case"teamraiser":d.api="CRTeamraiserAPI";break}if(d.contentType!="multipart/form-data"){d.contentType="application/x-www-form-urlencoded"}d.data="luminateExtend=true"+(d.data==""?"":"&"+d.data);if(d.form!=null&&a(d.form).length>0){d.data+="&"+a(d.form).eq(0).serialize()}if(d.data.indexOf("&api_key=")==-1){d.data+="&api_key="+luminateExtend.global.apiKey}if(luminateExtend.global.apiCommon.centerId!=null&&d.data.indexOf("&center_id=")==-1){d.data+="&center_id="+luminateExtend.global.apiCommon.centerId}if(luminateExtend.global.categoryId!=null&&d.data.indexOf("&list_category_id=")==-1){d.data+="&list_category_id="+luminateExtend.global.apiCommon.categoryId}if(d.data.indexOf("&response_format=xml")!=-1){d.data=d.data.replace(/&response_format=xml/g,"&response_format=json")}else if(d.data.indexOf("&response_format=")==-1){d.data+="&response_format=json"}if(luminateExtend.global.source!=null&&d.data.indexOf("&source=")==-1){d.data+="&source="+luminateExtend.global.apiCommon.source}if(luminateExtend.global.subSource!=null&&d.data.indexOf("&sub_source=")==-1){d.data+="&sub_source="+luminateExtend.global.apiCommon.subSource}if(d.data.indexOf("&suppress_response_codes=")==-1){d.data+="&suppress_response_codes=true"}if(d.data.indexOf("&v=")==-1){d.data+="&v=1.0"}if(d.requestType.toLowerCase()=="post"){d.requestType="POST"}else{d.requestType="GET"}var e="http://",f=luminateExtend.global.path.nonsecure.split("http://")[1];if(d.api=="CRDonationAPI"||d.api=="CRTeamraiserAPI"||d.api!="CRConnectAPI"&&(window.location.protocol=="https:"&&d.useHTTPS==null||d.useHTTPS==true)){d.useHTTPS=true}else{d.useHTTPS=false}if(d.useHTTPS){e="https://",f=luminateExtend.global.path.secure.split("https://")[1]}e+=f+d.api;var g=false,h=false,i=false;if(window.location.protocol==e.split("//")[0]&&document.domain==f.split("/")[0]&&!d.useHashTransport){g=true,h=true}else{var j=new XMLHttpRequest;if("withCredentials"in j&&!d.requiresAuth&&!(d.data.indexOf("&method=login")!=-1&&d.data.indexOf("&method=loginTest")==-1||d.data.indexOf("&method=logout")!=-1)&&!d.useHashTransport){h=true}else if("postMessage"in window&&!d.useHashTransport){i=true}}var k;if(h){k=function(){var b=(new Date).getTime();if(d.requiresAuth&&d.data.indexOf("&"+luminateExtend.global.auth.type+"=")==-1){d.data+="&"+luminateExtend.global.auth.type+"="+luminateExtend.global.auth.token}d.data+="&"+luminateExtend.global.sessionCookie+"&ts="+b;a.ajax({contentType:d.contentType,data:d.data,dataType:"json",success:function(a){var b;if(d.callback!=null){b=d.callback;if(d.callback.error&&a.errorResponse){b=d.callback.error}else if(d.callback.success){b=d.callback.success}}if(!(d.data.indexOf("&method=login")!=-1&&d.data.indexOf("&method=loginTest")==-1||d.data.indexOf("&method=logout")!=-1)){if(b){b(a)}return luminateExtend}else{var c=function(){b(a)};luminateExtend.api.getAuth({callback:c,useHTTPS:d.useHTTPS})}},type:d.requestType,url:e})}}else if(i){k=function(){var b=(new Date).getTime(),f="luminateApiPostMessage"+b,g=c(d.useHTTPS,"action=postMessage");if(d.requiresAuth&&d.data.indexOf("&"+luminateExtend.global.auth.type+"=")==-1){d.data+="&"+luminateExtend.global.auth.type+"="+luminateExtend.global.auth.token}d.data+="&"+luminateExtend.global.sessionCookie+"&ts="+b;if(!luminateExtend.api.request.postMessageEventHandler){luminateExtend.api.request.postMessageEventHandler={};luminateExtend.api.request.postMessageEventHandler.handler=function(b){var c=a.parseJSON(b.data),d=c.postMessageFrameId,e=a.parseJSON(decodeURIComponent(c.response));if(luminateExtend.api.request.postMessageEventHandler[d]){luminateExtend.api.request.postMessageEventHandler[d](d,e)}};if(typeof window.addEventListener!="undefined"){window.addEventListener("message",luminateExtend.api.request.postMessageEventHandler.handler)}else if(typeof window.attachEvent!="undefined"){window.attachEvent("onmessage",luminateExtend.api.request.postMessageEventHandler.handler)}}luminateExtend.api.request.postMessageEventHandler[f]=function(b,c){var e;if(d.callback!=null){e=d.callback;if(d.callback.error&&c.errorResponse){e=d.callback.error}else if(d.callback.success){e=d.callback.success}}if(!(d.data.indexOf("&method=login")!=-1&&d.data.indexOf("&method=loginTest")==-1||d.data.indexOf("&method=logout")!=-1)){if(e){e(c)}return luminateExtend}else{var f=function(){e(c)};luminateExtend.api.getAuth({callback:f,useHTTPS:d.useHTTPS})}a("#"+b).remove();delete luminateExtend.api.request.postMessageEventHandler[b]};a("body").append('<iframe style="position: absolute; top: 0; left: -999em;" '+'name="'+f+'" id="'+f+'">'+"</iframe>");a("#"+f).on("load",function(){var b="{"+'"postMessageFrameId": "'+a(this).attr("id")+'", '+'"requestUrl": "'+e+'", '+'"requestContentType": "'+d.contentType+'", '+'"requestData": "'+d.data+'", '+'"requestType": "'+d.requestType+'"'+"}",c=e.split("/site/")[0];document.getElementById(a(this).attr("id")).contentWindow.postMessage(b,c)});a("#"+f).attr("src",g)}}else{k=function(){var b=(new Date).getTime(),f="luminateApiHashTransport"+b,g=c(d.useHTTPS,"action=hashTransport"),h=window.location.protocol+"//"+document.domain+"/luminateExtend_client.html";if(d.requiresAuth&&d.data.indexOf("&"+luminateExtend.global.auth.type+"=")==-1){d.data+="&"+luminateExtend.global.auth.type+"="+luminateExtend.global.auth.token}d.data+="&"+luminateExtend.global.sessionCookie+"&ts="+b;g+="#&hashTransportClientUrl="+encodeURIComponent(h)+"&hashTransportFrameId="+f+"&requestUrl="+encodeURIComponent(e)+"&requestContentType="+encodeURIComponent(d.contentType)+"&requestData="+encodeURIComponent(d.data)+"&requestType="+d.requestType;if(!luminateExtend.api.request.hashTransportEventHandler){luminateExtend.api.request.hashTransportEventHandler={};luminateExtend.api.request.hashTransportEventHandler.handler=function(a,b){if(luminateExtend.api.request.hashTransportEventHandler[a]){luminateExtend.api.request.hashTransportEventHandler[a](a,b)}}}luminateExtend.api.request.hashTransportEventHandler[f]=function(b,c){if(d.callback!=null){var e=d.callback;if(d.callback.error&&c.errorResponse){e=d.callback.error}else if(d.callback.success){e=d.callback.success}e(c);return luminateExtend}a("#"+b).remove();delete luminateExtend.api.request.hashTransportEventHandler[b]};a("body").append('<iframe style="position: absolute; top: 0; left: -999em;" '+'name="'+f+'" id="'+f+'" '+'src="'+g+'"></iframe>')}}var l=false;if(d.requiresAuth&&luminateExtend.global.auth.token==null){l=true}else if(!g&&luminateExtend.global.sessionCookie==null){l=true}if(l){luminateExtend.api.getAuth({callback:k,returnLib:false,useHTTPS:d.useHTTPS})}else{k()}}};luminateExtend.sessionVars={set:function(a,b,c){var d={};if(c){d.callback=c}if(a){d.data="s_"+a+"="+(b?b:"");luminateExtend.utils.ping(d)}}};luminateExtend.utils={ensureArray:function(b){if(a.isArray(b)){return b}else{return[b]}},ping:function(b){var c=a.extend({callback:null,data:null},b||{});var d=(new Date).getTime(),e="luminatePing"+d,f=(window.location.protocol=="https:"?luminateExtend.global.path.secure:luminateExtend.global.path.nonsecure)+"PixelServer"+(c.data==null?"":"?"+c.data);a("body").append('<img style="position: absolute; left: -999em; top: 0;" '+'id="'+e+'" />');a("#"+e).on("load",function(){a(this).remove();if(c.callback!=null){c.callback()}return luminateExtend});a("#"+e).attr("src",f)},simpleDateFormat:function(a,b,c){c=c||luminateExtend.global.locale;c=c=="es_US"||c=="en_CA"||c=="fr_CA"||c=="en_GB"?c:"en_US";b=b||(this.locale=="en_CA"||this.locale=="fr_CA"||this.locale=="en_GB"?"d/M/yy":"M/d/yy");a=a||new Date;if(!(a instanceof Date)){var d=a.split("T")[0].split("-"),e=a.split("T").length>1?a.split("T")[1].split(".")[0].split("Z")[0].split("-")[0].split(":"):["00","00","00"];a=new Date(d[0],d[1]-1,d[2],e[0],e[1],e[2])}var f=function(a){a=""+a;return a.indexOf("0")==0&&a!="0"?a.substring(1):a};var g=function(a){a=Number(a);return isNaN(a)?"00":(a<10?"0":"")+a};var h={month:g(a.getMonth()+1),date:g(a.getDate()),year:g(a.getFullYear()),day:a.getDay(),hour24:a.getHours(),hour12:a.getHours(),minutes:g(a.getMinutes()),ampm:"AM"};if(h.hour24>11){h.ampm="PM"}h.hour24=g(h.hour24);if(h.hour12==0){h.hour12=12}if(h.hour12>12){h.hour12=h.hour12-12}h.hour12=g(h.hour12);var k;var l=function(a){var b=a.replace(/yy+(?=y)/g,"yy").replace(/MMM+(?=M)/g,"MMM").replace(/d+(?=d)/g,"d").replace(/EEE+(?=E)/g,"EEE").replace(/a+(?=a)/g,"").replace(/k+(?=k)/g,"k").replace(/h+(?=h)/g,"h").replace(/m+(?=m)/g,"m");var d=b.replace(/yyy/g,h.year).replace(/yy/g,h.year.substring(2)).replace(/y/g,h.year).replace(/dd/g,h.date).replace(/d/g,f(h.date)),e=function(a,b,c){for(i=1;i<a.length;i++){if(!isNaN(a[i].substring(0,1))){var d=a[i].substring(0,2);a[i]=a[i].substring(2);if(isNaN(d.substring(1))){a[i]=d.substring(1)+a[i];d=d.substring(0,1)}d=Number(d);if(d>23){d=23}var e=c=="+"?d:0-d;if(b=="kk"||b=="k"){e=Number(h.hour24)+e;if(e>24){e=e-24}else if(e<0){e=e+24}}else{e=Number(h.hour12)+e;if(e>24){e=e-24}else if(e<0){e=e+24}if(e>12){e=e-12}}e=""+e;if(b=="kk"||b=="hh"){e=g(e)}if(b=="h"&&e==0||b=="hh"&&e=="00"){e="12"}a[i]=e+a[i]}}return a.join("")};if(d.indexOf("k+")!=-1){d=e(d.split("kk+"),"kk","+");d=e(d.split("k+"),"k","+")}if(d.indexOf("k-")!=-1){d=e(d.split("kk-"),"kk","-");d=e(d.split("k-"),"k","-")}d=d.replace(/kk/g,h.hour24).replace(/k/g,f(h.hour24));if(d.indexOf("h+")!=-1){d=e(d.split("hh+"),"hh","+");d=e(d.split("h+"),"h","+")}if(d.indexOf("h-")!=-1){d=e(d.split("hh-"),"hh","-");d=e(d.split("h-"),"h","-")}d=d.replace(/hh/g,h.hour12<12&&h.hour12.indexOf&&h.hour12.indexOf("0")!=0?"0"+h.hour12:h.hour12).replace(/h/g,f(h.hour12));d=d.replace(/mm/g,h.minutes).replace(/m/g,f(h.minutes));d=d.replace(/a/g,"A");var j=["January","February","march","april","may","June","July","august","September","October","November","December"];if(c=="es_US"){j=["enero","febrero","marzo","abril","mayo","junio","julio","agosto","septiembre","octubre","noviembre","diciembre"]}if(c=="fr_CA"){j=["janvier","f&#233;vrier","mars","avril","mai","juin","juillet","ao&#251;t","septembre","octobre","novembre","d&#233;cembre"]}d=d.replace(/MMMM/g,j[Number(h.month)-1]).replace(/MMM/g,j[Number(h.month)-1].substring(0,3)).replace(/MM/g,h.month).replace(/M/g,f(h.month)).replace(/march/g,"March").replace(/may/g,"May");var k=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"];if(c=="es_US"){k=["domingo","lunes","martes","miércoles","jueves","viernes","sábado"]}if(c=="fr_CA"){k=["dimanche","lundi","mardi","mercredi","jeudi","vendredi","samedi"]}d=d.replace(/EEEE/g,k[h.day]).replace(/EEE/g,k[h.day].substring(0,3)).replace(/EE/g,k[h.day].substring(0,3)).replace(/E/g,k[h.day].substring(0,3));d=d.replace(/A/g,h.ampm).replace(/april/g,"April").replace(/august/g,"August");return d};if(b.indexOf("'")==-1){k=l(b)}else{var m=b.replace(/\'+(?=\')/g,"''").split("''");if(m.length==1){m=b.split("'");for(i=0;i<m.length;i++){if(i%2==0){m[i]=l(m[i])}}return m.join("")}else{for(i=0;i<m.length;i++){formatPatternParts2=m[i].split("'");for(j=0;j<formatPatternParts2.length;j++){if(j%2==0){formatPatternParts2[j]=l(formatPatternParts2[j])}}m[i]=formatPatternParts2.join("")}return m.join("'")}}return k}}})(jQuery)
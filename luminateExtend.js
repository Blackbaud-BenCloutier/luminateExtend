/* luminateExtend.js | Version: 1.3 (28-FEB-2013) */
(function(e){var t=function(e,t){var n=t||window;if(e){var r=e.split(".");for(var i=0;i<r.length;i++){if(i<r.length-1&&!n[r[i]]){n[r[i]]={}}n=n[r[i]]}}return n},n=function(e,t){var n=(e?luminateExtend.global.path.secure+"S":luminateExtend.global.path.nonsecure)+"PageServer?pagename=luminateExtend_server&pgwrap=n"+(luminateExtend.global.sessionCookie?"&"+luminateExtend.global.sessionCookie:"")+(t?"&"+t:"");return n};window.luminateExtend=function(e){luminateExtend.init(e||{})};luminateExtend.library={version:"1.3"};luminateExtend.global={update:function(t,n){if(t){if(t.length){luminateExtend.global[t]=n}else{luminateExtend.global=e.extend(luminateExtend.global,t)}}}};luminateExtend.init=function(t){var n=e.extend({apiCommon:{categoryId:null,centerId:null,source:null,subSource:null},apiKey:null,auth:{token:null,type:"auth"},locale:null,path:{nonsecure:null,secure:null}},t||{});if(n.locale!=null&&n.locale!="es_US"&&n.locale!="en_CA"&&n.locale!="fr_CA"&&n.locale!="en_GB"){n.locale="en_US"}if(n.locale!=null){luminateExtend.sessionVars.set("locale",n.locale)}luminateExtend.global=e.extend(luminateExtend.global,n);return luminateExtend};luminateExtend.api=function(e){luminateExtend.api.request(e||{})};luminateExtend.api.bind=function(n){n=n||"form.luminateApi";if(e(n).length>0){e(n).each(function(){if(this.nodeName.toLowerCase()=="form"){e(this).bind("submit",function(n){n.cancelBubble=true;n.returnValue=false;if(n.stopPropagation){n.stopPropagation();n.preventDefault()}var r=(new Date).getTime();if(!e(this).attr("id")){e(this).attr("id","luminateApi-"+r)}var i=e(this).attr("action"),s=i.split("?"),o=e(this).data("luminateapi"),u=s[0].indexOf("/site/")!=-1?s[0].split("/site/")[1]:s[0],a=null,f=e(this).attr("enctype"),l=s.length>1?s[1]:"",c="#"+e(this).attr("id"),h=false,p=e(this).attr("method"),d=false;if(o){if(o.callback){a=t(o.callback)}if(o.requiresAuth&&o.requiresAuth=="true"){h=true}if(i.indexOf("https:")==0||window.location.protocol=="https:"&&i.indexOf("http")==-1){d=true}}luminateExtend.api.request({api:u,callback:a,contentType:f,data:l,form:c,requestType:p,requiresAuth:h,useHTTPS:d})})}})}return luminateExtend};luminateExtend.api.getAuth=function(t){var r=e.extend({callback:null,useCache:true,useHTTPS:false},t||{});if(luminateExtend.api.getAuthLoad){luminateExtend.api.getAuthLoad=false;if(r.useCache&&luminateExtend.global.auth&&luminateExtend.global.auth.token&&luminateExtend.global.auth.token!=null&&luminateExtend.global.auth.type&&luminateExtend.global.auth.type!=null){luminateExtend.api.getAuthLoad=true;if(r.callback!=null){r.callback()}}else{e.ajax({dataType:"jsonp",success:function(e){luminateExtend.global.update(e);luminateExtend.api.getAuthLoad=true;if(r.callback!=null){r.callback()}},url:n(r.useHTTPS,"action=getAuth&callback=?")})}}else{var i=function(){luminateExtend.api.getAuth(r)},s=setTimeout(i,1e3)}};luminateExtend.api.getAuthLoad=true;luminateExtend.api.request=function(t){var r=e.extend({api:null,callback:null,contentType:"application/x-www-form-urlencoded",data:"",form:null,requestType:"GET",requiresAuth:false,useHashTransport:false,useHTTPS:null},t||{});var i=["addressbook","advocacy","connect","cons","content","datasync","donation","event","group","orgevent","recurring","survey","teamraiser"];if(e.inArray(r.api.toLowerCase(),i)>=0){r.api="CR"+r.api.charAt(0).toUpperCase()+r.api.slice(1).toLowerCase()+"API";r.api=r.api.replace("Addressbook","AddressBook").replace("Datasync","DataSync")}if(luminateExtend.global.path&&luminateExtend.global.path.nonsecure&&luminateExtend.global.path.nonsecure!=null&&luminateExtend.global.path.secure&&luminateExtend.global.path.secure!=null&&luminateExtend.global.apiKey&&luminateExtend.global.apiKey!=null&&r.api){if(r.contentType!="multipart/form-data"){r.contentType="application/x-www-form-urlencoded"}r.data="luminateExtend=true"+(r.data==""?"":"&"+r.data);if(r.form!=null&&e(r.form).length>0){r.data+="&"+e(r.form).eq(0).serialize()}if(r.data.indexOf("&api_key=")==-1){r.data+="&api_key="+luminateExtend.global.apiKey}if(luminateExtend.global.apiCommon.centerId!=null&&r.data.indexOf("&center_id=")==-1){r.data+="&center_id="+luminateExtend.global.apiCommon.centerId}if(luminateExtend.global.categoryId!=null&&r.data.indexOf("&list_category_id=")==-1){r.data+="&list_category_id="+luminateExtend.global.apiCommon.categoryId}if(r.data.indexOf("&response_format=xml")!=-1){r.data=r.data.replace(/&response_format=xml/g,"&response_format=json")}else if(r.data.indexOf("&response_format=")==-1){r.data+="&response_format=json"}if(luminateExtend.global.apiCommon.source!=null&&r.data.indexOf("&source=")==-1){r.data+="&source="+luminateExtend.global.apiCommon.source}if(luminateExtend.global.apiCommon.subSource!=null&&r.data.indexOf("&sub_source=")==-1){r.data+="&sub_source="+luminateExtend.global.apiCommon.subSource}if(r.data.indexOf("&suppress_response_codes=")==-1){r.data+="&suppress_response_codes=true"}if(luminateExtend.global.locale!=null&&r.data.indexOf("&s_locale=")==-1){r.data+="&s_locale="+luminateExtend.global.locale}if(r.data.indexOf("&v=")==-1){r.data+="&v=1.0"}r.requestType=r.requestType.toLowerCase()=="post"?"POST":"GET";var s="http://",o=luminateExtend.global.path.nonsecure.split("http://")[1];if(r.api=="CRDonationAPI"||r.api=="CRTeamraiserAPI"||r.api!="CRConnectAPI"&&(window.location.protocol=="https:"&&r.useHTTPS==null||r.useHTTPS==true)){r.useHTTPS=true}else{r.useHTTPS=false}if(r.useHTTPS){s="https://",o=luminateExtend.global.path.secure.split("https://")[1]}s+=o+r.api;var u=false,a=false,f=false;if(window.location.protocol==s.split("//")[0]&&document.domain==o.split("/")[0]&&!r.useHashTransport){u=true,a=true}else{var l=new XMLHttpRequest;if("withCredentials"in l&&!r.useHashTransport){a=true}else if("postMessage"in window&&!r.useHashTransport){f=true}}var c;if(a){c=function(){var t=(new Date).getTime();if(r.requiresAuth&&r.data.indexOf("&"+luminateExtend.global.auth.type+"=")==-1){r.data+="&"+luminateExtend.global.auth.type+"="+luminateExtend.global.auth.token}r.data+="&ts="+t;e.ajax({contentType:r.contentType,data:r.data,dataType:"json",success:function(e){var t;if(r.callback!=null){t=r.callback;if(r.callback.error&&e.errorResponse){t=r.callback.error}else if(r.callback.success){t=r.callback.success}}if(!(r.data.indexOf("&method=login")!=-1&&r.data.indexOf("&method=loginTest")==-1||r.data.indexOf("&method=logout")!=-1)){if(t){t(e)}return luminateExtend}else{var n=function(){t(e)};luminateExtend.api.getAuth({callback:n,useCache:false,useHTTPS:r.useHTTPS})}},type:r.requestType,url:s,xhrFields:{withCredentials:true}})}}else if(f){c=function(){var t=(new Date).getTime(),i="luminateApiPostMessage"+t,o=n(r.useHTTPS,"action=postMessage");r.data+="&ts="+t;if(!luminateExtend.api.request.postMessageEventHandler){luminateExtend.api.request.postMessageEventHandler={};luminateExtend.api.request.postMessageEventHandler.handler=function(t){var n=e.parseJSON(t.data),r=n.postMessageFrameId,i=e.parseJSON(decodeURIComponent(n.response)),s=n.global;if(s){luminateExtend.global.update(s)}if(luminateExtend.api.request.postMessageEventHandler[r]){luminateExtend.api.request.postMessageEventHandler[r](r,i)}};if(typeof window.addEventListener!="undefined"){window.addEventListener("message",luminateExtend.api.request.postMessageEventHandler.handler,false)}else if(typeof window.attachEvent!="undefined"){window.attachEvent("onmessage",luminateExtend.api.request.postMessageEventHandler.handler)}}luminateExtend.api.request.postMessageEventHandler[i]=function(t,n){var i;if(r.callback!=null){i=r.callback;if(r.callback.error&&n.errorResponse){i=r.callback.error}else if(r.callback.success){i=r.callback.success}}if(!(r.data.indexOf("&method=login")!=-1&&r.data.indexOf("&method=loginTest")==-1||r.data.indexOf("&method=logout")!=-1)){if(i){i(n)}}else{var s=function(){i(n)};luminateExtend.api.getAuth({callback:s,useCache:false,useHTTPS:r.useHTTPS})}e("#"+t).remove();delete luminateExtend.api.request.postMessageEventHandler[t]};e("body").append('<iframe style="position: absolute; top: 0; left: -999em;" '+'name="'+i+'" id="'+i+'">'+"</iframe>");e("#"+i).bind("load",function(){var t="{"+'"postMessageFrameId": "'+e(this).attr("id")+'", '+'"requestUrl": "'+s+'", '+'"requestContentType": "'+r.contentType+'", '+'"requestData": "'+r.data+'", '+'"requestType": "'+r.requestType+'"'+"}",n=s.split("/site/")[0];document.getElementById(e(this).attr("id")).contentWindow.postMessage(t,n)});e("#"+i).attr("src",o)}}else{c=function(){var t=(new Date).getTime(),i="luminateApiHashTransport"+t,o=n(r.useHTTPS,"action=hashTransport"),u=window.location.protocol+"//"+document.domain+"/luminateExtend_client.html";r.data+="&ts="+t;o+="#&hashTransportClientUrl="+encodeURIComponent(u)+"&hashTransportFrameId="+i+"&requestUrl="+encodeURIComponent(s)+"&requestContentType="+encodeURIComponent(r.contentType)+"&requestData="+encodeURIComponent(r.data)+"&requestType="+r.requestType;if(!luminateExtend.api.request.hashTransportEventHandler){luminateExtend.api.request.hashTransportEventHandler={};luminateExtend.api.request.hashTransportEventHandler.handler=function(e,t){if(luminateExtend.api.request.hashTransportEventHandler[e]){luminateExtend.api.request.hashTransportEventHandler[e](e,t)}}}luminateExtend.api.request.hashTransportEventHandler[i]=function(t,n){if(r.callback!=null){var i=r.callback;if(r.callback.error&&n.errorResponse){i=r.callback.error}else if(r.callback.success){i=r.callback.success}i(n);return luminateExtend}e("#"+t).remove();delete luminateExtend.api.request.hashTransportEventHandler[t]};e("body").append('<iframe style="position: absolute; top: 0; left: -999em;" '+'name="'+i+'" id="'+i+'" '+'src="'+o+'"></iframe>')}}var h=false;if(r.requiresAuth||!a&&!u&&luminateExtend.global.sessionCookie==null){h=true}if(h){luminateExtend.api.getAuth({callback:c,useHTTPS:r.useHTTPS})}else{c()}}};luminateExtend.sessionVars={set:function(e,t,n){var r={};if(n){r.callback=n}if(e){r.data="s_"+e+"="+(t||"");luminateExtend.utils.ping(r)}}};luminateExtend.tags=function(e,t){luminateExtend.tags.parse(e,t)};luminateExtend.tags.parse=function(n,r){n=n||"all";if(n=="all"){n=["cons"]}else{n=luminateExtend.utils.ensureArray(n)}r=r||"body";e.each(n,function(){if(n=="cons"){var i=e(r).find(document.getElementsByTagName("luminate:cons"));if(i.length>0){var s=function(n){i.each(function(){if(n.getConsResponse){e(this).replaceWith(t(e(this).attr("field"),n.getConsResponse))}else{e(this).remove()}})};luminateExtend.api.request({api:"cons",callback:s,data:"method=getUser",requestType:"POST",requiresAuth:true})}}})};luminateExtend.utils={ensureArray:function(t){if(e.isArray(t)){return t}else{return[t]}},ping:function(t){var n=e.extend({callback:null,data:null},t||{});var r=(new Date).getTime(),i="luminatePing"+r,s=(window.location.protocol=="https:"?luminateExtend.global.path.secure:luminateExtend.global.path.nonsecure)+"EstablishSession?"+(n.data==null?"":n.data+"&")+"NEXTURL="+encodeURIComponent((window.location.protocol=="https:"?luminateExtend.global.path.secure:luminateExtend.global.path.nonsecure)+"PixelServer");e("body").append('<img style="position: absolute; left: -999em; top: 0;" '+'id="'+i+'" />');e("#"+i).bind("load",function(){e(this).remove();if(n.callback!=null){n.callback()}return luminateExtend});e("#"+i).attr("src",s)},simpleDateFormat:function(e,t,n){n=n||luminateExtend.global.locale;n=n=="es_US"||n=="en_CA"||n=="fr_CA"||n=="en_GB"||n=="en_AU"?n:"en_US";t=t||(n=="en_CA"||n=="fr_CA"||n=="en_GB"||n=="en_AU"?"d/M/yy":"M/d/yy");e=e||new Date;if(!(e instanceof Date)){var r=e.split("T")[0].split("-"),i=e.split("T").length>1?e.split("T")[1].split(".")[0].split("Z")[0].split("-")[0].split(":"):["00","00","00"];e=new Date(r[0],r[1]-1,r[2],i[0],i[1],i[2])}var s=function(e){e=""+e;return e.indexOf("0")==0&&e!="0"?e.substring(1):e},o=function(e){e=Number(e);return isNaN(e)?"00":(e<10?"0":"")+e},u={month:o(e.getMonth()+1),date:o(e.getDate()),year:o(e.getFullYear()),day:e.getDay(),hour24:e.getHours(),hour12:e.getHours(),minutes:o(e.getMinutes()),ampm:"AM"};if(u.hour24>11){u.ampm="PM"}u.hour24=o(u.hour24);if(u.hour12==0){u.hour12=12}if(u.hour12>12){u.hour12=u.hour12-12}u.hour12=o(u.hour12);var a,f=function(e){var t=e.replace(/yy+(?=y)/g,"yy").replace(/MMM+(?=M)/g,"MMM").replace(/d+(?=d)/g,"d").replace(/EEE+(?=E)/g,"EEE").replace(/a+(?=a)/g,"").replace(/k+(?=k)/g,"k").replace(/h+(?=h)/g,"h").replace(/m+(?=m)/g,"m"),r=t.replace(/yyy/g,u.year).replace(/yy/g,u.year.substring(2)).replace(/y/g,u.year).replace(/dd/g,u.date).replace(/d/g,s(u.date)),i=function(e,t,n){for(var r=1;r<e.length;r++){if(!isNaN(e[r].substring(0,1))){var i=e[r].substring(0,2);e[r]=e[r].substring(2);if(isNaN(i.substring(1))){e[r]=i.substring(1)+e[r];i=i.substring(0,1)}i=Number(i);if(i>23){i=23}var s=n=="+"?i:0-i;if(t=="kk"||t=="k"){s=Number(u.hour24)+s;if(s>24){s=s-24}else if(s<0){s=s+24}}else{s=Number(u.hour12)+s;if(s>24){s=s-24}else if(s<0){s=s+24}if(s>12){s=s-12}}s=""+s;if(t=="kk"||t=="hh"){s=o(s)}if(t=="h"&&s==0||t=="hh"&&s=="00"){s="12"}e[r]=s+e[r]}}return e.join("")};if(r.indexOf("k+")!=-1){r=i(r.split("kk+"),"kk","+");r=i(r.split("k+"),"k","+")}if(r.indexOf("k-")!=-1){r=i(r.split("kk-"),"kk","-");r=i(r.split("k-"),"k","-")}r=r.replace(/kk/g,u.hour24).replace(/k/g,s(u.hour24));if(r.indexOf("h+")!=-1){r=i(r.split("hh+"),"hh","+");r=i(r.split("h+"),"h","+")}if(r.indexOf("h-")!=-1){r=i(r.split("hh-"),"hh","-");r=i(r.split("h-"),"h","-")}r=r.replace(/hh/g,u.hour12<12&&u.hour12.indexOf&&u.hour12.indexOf("0")!=0?"0"+u.hour12:u.hour12).replace(/h/g,s(u.hour12));r=r.replace(/mm/g,u.minutes).replace(/m/g,s(u.minutes));r=r.replace(/a/g,"A");var a=["January","February","march","april","may","June","July","august","September","October","November","December"];if(n=="es_US"){a=["enero","febrero","marzo","abril","mayo","junio","julio","agosto","septiembre","octubre","noviembre","diciembre"]}if(n=="fr_CA"){a=["janvier","f&"+"#233;vrier","mars","avril","mai","juin","juillet","ao&"+"#251;t","septembre","octobre","novembre","d&"+"#233;cembre"]}r=r.replace(/MMMM/g,a[Number(u.month)-1]).replace(/MMM/g,a[Number(u.month)-1].substring(0,3)).replace(/MM/g,u.month).replace(/M/g,s(u.month)).replace(/march/g,"March").replace(/may/g,"May").replace(/Mayo/g,"mayo");var f=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"];if(n=="es_US"){f=["domingo","lunes","martes","mi&"+"eacute;rcoles","jueves","viernes","s&"+"aacute;bado"]}if(n=="fr_CA"){f=["dimanche","lundi","mardi","mercredi","jeudi","vendredi","samedi"]}r=r.replace(/EEEE/g,f[u.day]).replace(/EEE/g,f[u.day].substring(0,3)).replace(/EE/g,f[u.day].substring(0,3)).replace(/E/g,f[u.day].substring(0,3));r=r.replace(/A/g,u.ampm).replace(/april/g,"April").replace(/august/g,"August");return r};if(t.indexOf("'")==-1){a=f(t)}else{var l=t.replace(/\'+(?=\')/g,"''").split("''");if(l.length==1){l=t.split("'");for(var c=0;c<l.length;c++){if(c%2==0){l[c]=f(l[c])}}return l.join("")}else{for(var c=0;c<l.length;c++){formatPatternParts2=l[c].split("'");for(var h=0;h<formatPatternParts2.length;h++){if(h%2==0){formatPatternParts2[h]=f(formatPatternParts2[h])}}l[c]=formatPatternParts2.join("")}return l.join("'")}}return a}}})(jQuery)